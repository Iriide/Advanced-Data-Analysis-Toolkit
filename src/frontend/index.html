<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Data Analysis Toolkit</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="static/style.css">

    <link rel="icon" type="image/svg+xml" href="static/icon.svg">


</head>
<body>

    <div class="container-fluid main-container">

        <!-- Header Row -->
        <div class="d-flex justify-content-between align-items-center mb-3 flex-shrink-0">
            <h3 class="fw-bold text-secondary m-0"><i class="fas fa-layer-group me-2"></i>Advanced Data Analysis Toolkit</h3>
            <div class="d-flex align-items-center gap-2">
                <button id="infoBtn" class="settings-btn" data-bs-toggle="modal" data-bs-target="#infoModal" title="About">
                    <i class="fas fa-info"></i>
                </button>
                <button class="settings-btn" data-bs-toggle="modal" data-bs-target="#settingsModal" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <!-- TOP ROW: 3 Columns (Takes 45% of remaining height) -->
        <div class="row g-3 row-fill mb-3" style="height: 45vh; flex-grow: 45;">
            <!-- Col 1 -->
            <div class="col-md-4" style="height: 45vh;">
                <div class="card h-100">
                    <div class="card-header header-blue">
                        <i class="fas fa-database text-primary"></i>
                        <span>Database Schema</span>
                            <div class="ms-auto d-flex align-items-center gap-2">
                                <button id="downloadSchemaBtn" class="settings-btn compact" title="Download schema image">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center bg-white">
                        <figure class="m-0" style="width: 100%; height: 100%;">
                            <img id="img1" class="img-display" alt="Database Schema" style="width: 100%; height: 100%; object-fit: contain;">
                        </figure>
                    </div>
                </div>
            </div>
            <!-- Col 2 -->
            <div class="col-md-8" style="height: 45vh;">
                <div class="card h-100">
                    <div class="card-header header-purple">
                        <i class="fas fa-chart-bar text-purple"></i>
                        <span>Statistics of Database Tables and Columns</span>
                        <div class="ms-auto d-flex align-items-center gap-2">
                            <button id="downloadDescribeCsvBtn" class="settings-btn compact" title="Download statistics (CSV)">
                                <i class="fas fa-file-csv"></i>
                            </button>
                        </div>
                    </div>
                    <div id="table1" class="card-body d-flex align-items-center justify-content-center">
                    </div>
                </div>
            </div>

        </div>

        <!-- BOTTOM ROW: 2 Columns (Takes 55% of remaining height) -->
        <div class="row g-3 row-fill" style="flex-grow: 45;">

            <!-- Bottom Left: Input -->
            <div class="col-md-6" style="height: 45vh;">
                <div class="card h-100">
                    <div class="card-header header-orange d-flex align-items-center">
                        <i class="fas fa-pen-to-square text-warning"></i>
                        <span class="flex-grow-1 ms-2">Interactive Analysis</span>
                        <button id="randomQuestionBtn" class="settings-btn compact ms-auto" style="color: #ffc107; border-color: #ffc107;" title="Random question">
                            <i class="fas fa-dice-five"></i>
                        </button>
                    </div>
                    <div class="card-body input-panel">
                        <!-- <label for="promptInput" class="form-label text-muted small text-uppercase fw-bold">
                            Enter your analysis request:
                        </label> -->
                        <textarea class="form-control mb-3" id="promptInput"
                            title="Ask about any data-related question from the database"
                            placeholder="Enter text here to generate a new image visualization..."
                            style="height: 100%;">
                        </textarea>

                        <div class="d-flex justify-content-between align-items-center flex-shrink-0">
                            <small class="text-muted" id="statusText">Ready to send</small>
                            <button id="generateBtn" onclick="handleSend()" class="btn btn-primary px-3">
                                <i class="fas fa-wand-magic-sparkles me-2"></i>Generate Visualization!
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Right: Output Image -->
            <div class="col-md-6" style="height: 45vh;">
                <div class="card h-100">
                    <div class="card-header header-purple d-flex align-items-center">
                        <i class="fas fa-image text-secondary"></i>
                        <div>
                            <span>Generated Visualization</span>
                            <span id="outputBadge" class="badge bg-secondary bg-opacity-10 text-secondary status-badge ms-2" style="transform:translateY(-2px)">Empty</span>
                        </div>
                        <div class="ms-auto d-flex align-items-center gap-2">
                            <button id="downloadResultCurrentBtn" class="settings-btn compact" title="Download current view">
                                <i class="fas fa-download"></i>
                            </button>
                            <button id="downloadResultAllBtn" class="settings-btn compact" title="Download image + table">
                                <i class="fas fa-file-archive"></i>
                            </button>
                            <button id="toggleViewBtn" class="settings-btn compact" style="color: #6f42c1; border-color: #6f42c1;" title="Change view">
                                <i id="toggleViewIcon" class="fas fa-table"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body d-flex align-items-center justify-content-center bg-white">
                        <div id="resultLoader" class="loader"><i class="fas fa-cube fa-2x"></i></div>
                        <div id="resultDisplay" style="width:100%; height:100%; position:relative;">
                            <img id="resultImage" class="img-display" alt="Result" style="width: 100%; height: 100%; object-fit: contain;">
                            <div id="resultTableContainer" style="display:none; width:100%; height:100%; overflow:auto; padding:8px; box-sizing:border-box;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold"><i class="fas fa-cogs me-2"></i>Configuration Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="settingsForm">

                        <!-- Google API Key -->
                        <div class="mb-3">
                            <label for="googleApiKey" class="form-label fw-bold small text-uppercase text-muted">Google API Key</label>
                            <input type="password" class="form-control" id="googleApiKey" placeholder="Enter API Key">
                        </div>

                        <!-- Database Selection -->
                        <div class="mb-3">
                            <label for="dbSelect" class="form-label fw-bold small text-uppercase text-muted">Database Type</label>
                            <select class="form-select" id="dbSelect" onchange="toggleDbFields()">
                                <option value="SQLITE">SQLite</option>
                                <option value="POSTGRES">PostgreSQL</option>
                            </select>
                        </div>

                        <hr class="my-4">

                        <!-- SQLite Fields -->
                        <div id="sqliteFields">
                            <div class="mb-3">
                                <label for="sqlitePath" class="form-label fw-bold small text-uppercase text-muted">SQLite DB File Path</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-file-database"></i></span>
                                    <input type="text" class="form-control" id="sqlitePath" placeholder="/path/to/database.db">
                                </div>
                            </div>
                        </div>

                        <!-- Postgres Fields -->
                        <div id="postgresFields" style="display: none;">
                            <div class="mb-3">
                                <label for="pgHost" class="form-label fw-bold small text-uppercase text-muted">Host URL</label>
                                <input type="text" class="form-control" id="pgHost" placeholder="postgres://host:5432">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="pgLogin" class="form-label fw-bold small text-uppercase text-muted">Login</label>
                                    <input type="text" class="form-control" id="pgLogin" placeholder="username">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="pgPassword" class="form-label fw-bold small text-uppercase text-muted">Password</label>
                                    <input type="password" class="form-control" id="pgPassword" placeholder="password">
                                </div>
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="saveSettingsBtn" type="button" class="btn btn-primary" data-bs-dismiss="modal">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PREVIEW MODAL -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-md-down">
            <div class="modal-content" style="height:90vh;">
                <div class="modal-header">
                    <h5 id="previewModalTitle" class="modal-title">Preview</h5>
                    <div class="d-flex align-items-center ms-3">
                        <!-- Recenter preview button -->
                        <button id="recenterPreviewBtn" type="button" class="settings-btn compact me-2" title="Recenter preview" aria-label="Recenter preview">
                            <i class="fa fa-search"></i>
                        </button>
                        <!-- <button id="zoomModeBtn" type="button" class="btn btn-sm btn-outline-secondary me-2" title="Toggle zoom mode (mouse / center)">
                            <i id="zoomModeIcon" class="fas fa-mouse-pointer"></i>
                        </button> -->
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body d-flex align-items-center justify-content-center" style="overflow:auto;">
                    <div id="previewModalBody" style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; cursor: grab;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- INFO MODAL -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold"><i class="fas fa-info-circle me-2"></i>About This App</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-2">Advanced Data Analysis Toolkit provides a lightweight interface to explore database schemas, describe tables, and generate visualizations driven by natural language prompts.</p>
                    <ul>
                        <li>Use <strong>Settings</strong> to connect a database or configure an LLM API key.</li>
                        <li>Click <strong>Random question</strong> (dice) to get LLM-suggested analysis prompts.</li>
                        <li>Click images or tables to open a larger preview with zoom and pan.</li>
                    </ul>
                    <p class="text-muted small mb-0">This is a demo tool — ensure your API keys and database paths are set before using LLM-powered features.</p>
                    <hr>
                    <p class="mb-0"><strong>Authors:</strong> Mateusz Mazur, Paulina Pojda, Joanna Wójcicka</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

            <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="static/script.js?11"></script>
</body>
</html>
